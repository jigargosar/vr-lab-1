<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>VR Graffiti</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.js"></script>
  <script>
    AFRAME.registerComponent('paint-controls', {
      init: function () {
        this.isDrawing = false;
        this.strokeContainer = null;
        this.lastPos = null;
        this.lineIndex = 0;

        this.el.addEventListener('triggerdown', () => this.startDrawing());
        this.el.addEventListener('triggerup', () => this.stopDrawing());
      },

      startDrawing: function () {
        this.isDrawing = true;
        this.lastPos = null;
        this.lineIndex = 0;

        // Container for line segments
        this.strokeContainer = document.createElement('a-entity');
        this.strokeContainer.classList.add('stroke');
        this.el.sceneEl.appendChild(this.strokeContainer);
      },

      stopDrawing: function () {
        this.isDrawing = false;
        this.strokeContainer = null;
        this.lastPos = null;
      },

      tick: function () {
        if (!this.isDrawing || !this.strokeContainer) return;

        const worldPos = new THREE.Vector3();
        this.el.object3D.getWorldPosition(worldPos);

        if (this.lastPos && this.lastPos.distanceTo(worldPos) > 0.005) {
          // Add line segment
          this.strokeContainer.setAttribute(`line__${this.lineIndex}`, {
            start: `${this.lastPos.x} ${this.lastPos.y} ${this.lastPos.z}`,
            end: `${worldPos.x} ${worldPos.y} ${worldPos.z}`,
            color: '#ff66aa'
          });
          this.lineIndex++;
        }

        this.lastPos = worldPos.clone();
      }
    });
  </script>
</head>
<body>
  <a-scene>
    <!-- Sky gradient - dark above, slightly lighter at horizon -->
    <a-sky color="#1a1a2e"></a-sky>

    <!-- Grid floor for spatial reference -->
    <a-plane
      position="0 0 0"
      rotation="-90 0 0"
      width="50"
      height="50"
      color="#2d2d44"
      material="opacity: 0.8"
    ></a-plane>

    <!-- Grid lines on floor -->
    <a-entity
      geometry="primitive: plane; width: 50; height: 50"
      position="0 0.01 0"
      rotation="-90 0 0"
      material="src: url(data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Crect width='100' height='100' fill='none' stroke='%23444466' stroke-width='1'/%3E%3C/svg%3E); repeat: 50 50; transparent: true"
    ></a-entity>

    <!-- Ambient light -->
    <a-light type="ambient" color="#446" intensity="0.4"></a-light>

    <!-- Directional light for depth -->
    <a-light type="directional" color="#fff" intensity="0.6" position="1 2 1"></a-light>

    <a-entity id="rig">
      <a-camera position="0 1.6 0"></a-camera>
      <a-entity id="left-hand" laser-controls="hand: left" paint-controls></a-entity>
      <a-entity id="right-hand" laser-controls="hand: right" paint-controls></a-entity>
    </a-entity>
  </a-scene>
</body>
</html>